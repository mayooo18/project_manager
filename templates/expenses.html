{% extends 'base.html' %}

{% block content %}
<h2>Add Expense</h2>
<form method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    <p>{{ form.project_id.label }} {{ form.project_id() }}</p>
    <p>{{ form.category.label }} {{ form.category() }}</p>
    <p>{{ form.description.label }} {{ form.description(size=40) }}</p>
    <p>{{ form.amount.label }} {{ form.amount() }}</p>
    <p>{{ form.date.label }} {{ form.date() }}</p>
    <p>{{ form.note.label }} {{ form.note(rows=2) }}</p>
    <p>{{ form.receipt.label }} {{ form.receipt() }}</p>
    <p>{{ form.submit() }}</p>
</form>

<hr>

<h2>All Expenses</h2>
<table border="1" cellpadding="5">
    <tr>
        <th>Project</th>
        <th>Description</th>
        <th>Amount</th>
        <th>Category</th>
        <th>Date</th>
        <th>Note</th>
        <th>Receipt</th>
        <th>Actions</th>
    </tr>
    {% for expense in expenses %}
    <tr>
        <td>{{ expense.project.name }}</td>
        <td>{{ expense.description }}</td>
        <td>${{ "%.2f"|format(expense.amount) }}</td>
        <td>{{ expense.category }}</td>
        <td>{{ expense.date.strftime('%Y-%m-%d') }}</td>
        <td>{{ expense.note }}</td>
        <td>
            {% if expense.receipt_filename %}
                <a href="{{ url_for('static', filename='uploads/' ~ expense.receipt_filename) }}" target="_blank">View</a>
            {% else %}
                No File
            {% endif %}
        </td>
        
        <td>
            <a href="{{ url_for('edit_expense', expense_id=expense.id) }}">Edit</a>
            <form method="POST" action="{{ url_for('delete_expense', expense_id=expense.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this expense?');">
                <button type="submit">Delete</button>
            </form>
        </td>
        
    </tr>
    {% endfor %}
</table>
{% endblock %}
